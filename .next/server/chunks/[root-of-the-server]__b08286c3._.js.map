{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Mini-Invetory/src/lib/firebase-admin.ts"],"sourcesContent":["import { initializeApp, getApps, cert, type App } from \"firebase-admin/app\";\r\nimport { getAuth, type Auth } from \"firebase-admin/auth\";\r\n\r\nlet app: App | null = null;\r\n\r\nfunction getFirebaseAdmin(): { app: App; auth: Auth } {\r\n  if (!app) {\r\n    const privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n');\r\n    \r\n    if (!privateKey || !process.env.FIREBASE_CLIENT_EMAIL || !process.env.FIREBASE_PROJECT_ID) {\r\n      throw new Error(\"Missing Firebase Admin SDK configuration\");\r\n    }\r\n\r\n    if (getApps().length === 0) {\r\n      app = initializeApp({\r\n        credential: cert({\r\n          projectId: process.env.FIREBASE_PROJECT_ID,\r\n          clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n          privateKey: privateKey,\r\n        }),\r\n      });\r\n    } else {\r\n      app = getApps()[0]!;\r\n    }\r\n  }\r\n\r\n  return {\r\n    app: app!,\r\n    auth: getAuth(app!)\r\n  };\r\n}\r\n\r\nexport { getFirebaseAdmin };"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;;AAEA,IAAI,MAAkB;AAEtB,SAAS;IACP,IAAI,CAAC,KAAK;QACR,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;QAErE,IAAI,CAAC,cAAc,CAAC,QAAQ,GAAG,CAAC,qBAAqB,IAAI,CAAC,QAAQ,GAAG,CAAC,mBAAmB,EAAE;YACzF,MAAM,IAAI,MAAM;QAClB;QAEA,IAAI,IAAA,2JAAO,IAAG,MAAM,KAAK,GAAG;YAC1B,MAAM,IAAA,iKAAa,EAAC;gBAClB,YAAY,IAAA,wJAAI,EAAC;oBACf,WAAW,QAAQ,GAAG,CAAC,mBAAmB;oBAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;oBAC9C,YAAY;gBACd;YACF;QACF,OAAO;YACL,MAAM,IAAA,2JAAO,GAAE,CAAC,EAAE;QACpB;IACF;IAEA,OAAO;QACL,KAAK;QACL,MAAM,IAAA,6JAAO,EAAC;IAChB;AACF","debugId":null}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Mini-Invetory/src/app/api/user/profile/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { getFirebaseAdmin } from \"@/lib/firebase-admin\";\r\nimport { cookies } from \"next/headers\";\r\n\r\n// GET user profile\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    const sessionCookie = cookieStore.get(\"auth-token\")?.value;\r\n\r\n    if (!sessionCookie) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const { auth } = getFirebaseAdmin();\r\n    const decodedClaims = await auth.verifySessionCookie(sessionCookie);\r\n    const uid = decodedClaims.uid;\r\n\r\n    // Get user profile from Firestore using Admin SDK\r\n    const admin = await import(\"firebase-admin/firestore\");\r\n    const db = admin.getFirestore();\r\n    \r\n    const userDoc = await db.collection(\"users\").doc(uid).get();\r\n    \r\n    if (!userDoc.exists) {\r\n      return NextResponse.json({ profile: null });\r\n    }\r\n\r\n    const data = userDoc.data();\r\n    const profile = {\r\n      uid,\r\n      ...data,\r\n      lastLogin: data?.lastLogin?.toDate?.()?.toISOString(),\r\n      createdAt: data?.createdAt?.toDate?.()?.toISOString(),\r\n    };\r\n\r\n    return NextResponse.json({ profile });\r\n  } catch (error) {\r\n    console.error(\"Error getting user profile:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// POST create user profile\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    const sessionCookie = cookieStore.get(\"auth-token\")?.value;\r\n\r\n    if (!sessionCookie) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const { auth } = getFirebaseAdmin();\r\n    const decodedClaims = await auth.verifySessionCookie(sessionCookie);\r\n    const uid = decodedClaims.uid;\r\n\r\n    const body = await request.json();\r\n    const { profile } = body;\r\n\r\n    // Create user profile using Admin SDK\r\n    const admin = await import(\"firebase-admin/firestore\");\r\n    const db = admin.getFirestore();\r\n    \r\n    const userProfile = {\r\n      ...profile,\r\n      uid,\r\n      createdAt: admin.FieldValue.serverTimestamp(),\r\n      lastLogin: admin.FieldValue.serverTimestamp(),\r\n    };\r\n\r\n    await db.collection(\"users\").doc(uid).set(userProfile);\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error(\"Error creating user profile:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// PUT update user profile\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    const sessionCookie = cookieStore.get(\"auth-token\")?.value;\r\n\r\n    if (!sessionCookie) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const { auth } = getFirebaseAdmin();\r\n    const decodedClaims = await auth.verifySessionCookie(sessionCookie);\r\n    const uid = decodedClaims.uid;\r\n\r\n    const body = await request.json();\r\n    const { updates } = body;\r\n\r\n    // Update user profile using Admin SDK\r\n    const admin = await import(\"firebase-admin/firestore\");\r\n    const db = admin.getFirestore();\r\n    \r\n    const updateData = {\r\n      ...updates,\r\n      lastLogin: admin.FieldValue.serverTimestamp(),\r\n    };\r\n\r\n    await db.collection(\"users\").doc(uid).update(updateData);\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error(\"Error updating user profile:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}